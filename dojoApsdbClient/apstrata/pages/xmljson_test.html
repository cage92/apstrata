<html><head>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">

<title> XML/JSON - Tests </title>
<script type="text/javascript" src="xmljson_test_files/xml2json.js"></script>
<script type="text/javascript" src="xmljson_test_files/json2xml.js"></script>
<script type="text/javascript" src="../dojoroot/dojo/dojo.js" djConfig="parseOnLoad: true"></script>
<script type="text/javascript">



var xml=[
      '<?xml version="1.0" encoding="utf-8"?> <response xmlns="http://www.apstrata.com/services/schemas/apstrata_database_response.xsd"> <status>success</status><result><count>3</count><documents><document key="85626AA18C085679C06E2678AC44BEE1"><field name="photoId"><value><![CDATA[2869959453]]></value></field><field name="farm"><value><![CDATA[4]]></value></field></document><document key="F8A2C042FF137959CE01ADF3AF9E9F12"><field name="photoId"><value><![CDATA[2869959453]]></value></field><field name="farm"><value><![CDATA[4]]></value></field></document><document key="CDE7D2F8F416DF6D0B8D91CD93046B10"><field name="photoId"><value><![CDATA[2869959453]]></value></field><field name="farm"><value><![CDATA[4]]></value></field></document></documents></result> </response>',
      
      '<document key="85626AA18C085679C06E2678AC44BEE1"><field name="photoId"><value><![CDATA[2869959453]]></value></field><field name="farm"><value><![CDATA[4]]></value></field></document>',
      
      '<e>\n'+
      '  <![CDATA[ .. some data .. ]]>\n'+
      '  <![CDATA[ .. more data .. ]]>\n'+
      '</e>'
   ];

function parseXml(xml) {
   var dom = null;
   if (window.DOMParser) {
      try { 
         dom = (new DOMParser()).parseFromString(xml, "text/xml"); 
      } 
      catch (e) { dom = null; }
   }
   else if (window.ActiveXObject) {
      try {
         dom = new ActiveXObject('Microsoft.XMLDOM');
         dom.async = false;
         if (!dom.loadXML(xml)) // parse error ..
            window.alert(dom.parseError.reason + dom.parseError.srcText);
      } 
      catch (e) { dom = null; }
   }
   else
      alert("oops");
   return dom;
}

window.onload = function() {
   var json;
//      document.write(xml[0] + "\n\n" + (json = xml2json(parseXml(xml[0]), "  ")) + "\n\n" + json2xml(eval('json='+json)));
      
      var dom = parseXml(xml[1]);
      var jsonTxt = xml2json(dom, "");
//      var obj = eval(jsonTxt);
      console.debug(jsonTxt);
//      document.write(obj);
}

function show(s) { document.getElementById("out").innerHTML += (s+"\n").replace(/&/g, "&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g, "<br/>") + "<hr/>"; }

</script>
</head><body>
</body></html>