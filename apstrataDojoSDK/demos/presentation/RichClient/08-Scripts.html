<div class='Slide'>
	<div class='title' style='font-size: 3em; padding-top: 15px;'>
		Scripting Apstrata
	</div>
	<div  class='contents'>
		<ul>
			<li>Apstrata offer a server-side Javascript interface to allow additional control over apstrata behavior in response to API calls.  Scripts can
			become autonomous API entry points or can be used as interceptors to modify behavior of calls to existing apstrata  APIs.</li>
			<li>Developers can use scripts
			to link together multiple API functionalities into a single  request from the rich client UI. This allows developer to create complex
			functionality directly on the apstrata backend.</li>
			<li>The scripting environment  supports making HTTP calls to interact with external services and to fetch digital assets into the apstrata environment.</li>
			<li>Together these features allow orchestrating the complex interactions characteristic of data hub applications.</li>
		</ul>
		<br/>
		<div class="example" >
			Example <a href="#sub:sldUploadExampleCode">pseudo-code</a> of a script which accepts
			an uploaded video file, saves it to a document then enqueues the video for encoding on <b>encoding.com</b>.
		</div>
			<div class="example" >
			Example <a href="#sub:sldRegisterExampleCode">pseudo-code</a> of a script which registers a new user after verifying the
			the reCaptcha solution from the browser is correct.
		</div>
		
	</div>
	<div id='sldUploadExampleCode' style='visibility: hidden;'>
			<pre style="font-size: xx-small; ">
// Get reference to uploaded file from script request
var file = request.files.videoFile;

// Create a document containing the uploaded file and any fields
var saveResult = apsdb.callApi("SaveDocument", {"apsdb.store" : "DefaultStore"
	/*other fields*/},  { videoFile : file });

// If the SaveDocument succeeded, then let's send enqueue the
// file on encoding.com.  Otherwise return an error to the UI;
if (saveResult.status != "success") {
  result = "Error saving uploaded file";
} else {
  // create request XML for encoding.doc.  Include a callback URL
  // to the "GetFile" service to allow encoding.com to fetch the video
  var transcodeXml = ....
  httpRsp = apsdb.callHttp("https://manage.encdoing.com/", "GET"
      , { xml : transcodeXml }, null, null, false);
}

if ( httpRsp.status == 200
  && /* check for various encoding.com error code in response */) {
    result  = "Video file enqueued successfully";
} else {
   // Value of the "result" variable is passed back to the UI in the 
   // "RunScript" response.
   result = { msg : "Error encoding video", status : httpRsp.status
       , RspBody : httpRsp.body };
 }
			</pre>
		</div>
		<div id='sldRegisterExampleCode' style='visibility: hidden;'>
			<pre style="font-size: xx-small; ">
// Compose params to reCaptcha verify
var params = {
  privatekey : 
  , remoteip : request.headers.REMOTE_HOST
  , challenge : request.parameters.challengeToken
  , response : request.parameters.captchaResult
};

// Verify reCaptcha
var httpRsp = apsdb.callHttp("https://api-verify.recaptcha.net/verify /"
    , "POST", params, null, null, false);

// If the captcha is correct, register the user
if (httpRsp.status == 200) { 
  // reCaptcha status string is line 1 of resp body
  if (httpRsp.body.split('\n')[0] == false) {
    // reCaptcha error code string is line 2 of resp body
    result = { status : "failure", message : httpRsp.body.split('\n')[1] };
  } else {
    var saveUserRsp = apsdb.callApi("SaveUser"
        , apsim.user : request.parameters.login, /* more user profile fields */
    // return result of SaveUser API call direct to client UI
    result = saveUserRsp; 
  }
} else {
  result = {status : "failure", message : "recaptcha-not-reachable" };
}
			</pre>
		</div>
</div>