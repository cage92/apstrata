<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>ap((strata query</title>
    <style type="text/css">
        @import "../../apstrata/resources/css/apstrata.css";
		
		body {font-family: sans-serif; font-size: 10pt;}
		.label {font-size: 1em; color: #454545;}
		.value {font-size: 1.5em; color: #1212AA;}
		.delete {font-size: 1em; color: gray;}
    </style>

	    <link rel="shortcut icon" href="images/favicon.png" type="image/png" />
    
	<script type="text/javascript" src="../../lib/dojo/1.3.0-src/dojo/dojo.js" djConfig="parseOnLoad: true,debug:true"></script>

	<script type="text/javascript" src="widgets/LoadFormObject.js"></script>

    <script type="text/javascript">

        var connection
		
		function save(){
			connection = new apstrata.apsdb.client.Connection({statusWidget: "apstrata.apsdb.client.widgets.ConnectionStatus"});
			var formObject = dijit.byId("formObj");
				if(formObject.validate()){
				dojo.byId("successMessage").innerHTML = "Your survey is being processed...";
				var jsonObj = formObject.getValues();
				
				var survey = this;

				var client = new apstrata.apsdb.client.Client();
				var sd = client.saveDocument(
					function() {
						dojo.byId("successMessage").innerHTML = "Your survey has been successfully submitted.";
					}, function() {
						dojo.byId("successMessage").innerHTML = "A problem occured while submitting your survey, please try again later.";
					},
					{
						store: "myStore",
						fields: jsonObj
					}
				)
				
				return true;
			
			} else{
				dojo.byId("successMessage").innerHTML = "";
				return false;
			}
		}
		
		function test2(){
			alert("new");
		}
		
		function test(){
			var formObject = dijit.byId("formObj");
			var jsonObj = formObject.getValues();
				
			console.dir(jsonObj);
			alert(333);
		}
		
		var tt = this;
		
	    var schema = '{"template":{"module":"widgets","url":"templates/test.html"}, "fields":[{"label":"First Name","type":"text","mandatory":true,"name":"firstName","defaultValue":"enter your name here"},{"label":"Last Name","type":"text","mandatory":false,"name":"lastName","defaultValue":""},{"label":"Title","type":"list","choices":"Mrs.,Mr.","mandatory":true,"name":"title","defaultValue":"Mrs."},{"label":"Single","type":"checkbox","mandatory":false,"name":"maritalStatus","defaultValue":true},{"label":"Looking for","type":"radio button","choices":"Friends,Love,Other","mandatory":true,"name":"lookingFor","defaultValue":"Other"},{"label":"Hobbies","type":"multiple choice","choices":"reading,sport,dancing","mandatory":false,"name":"hobbies","defaultValue":["dancing"]},{"type":"button","label":"test","action":function(){tt.test()},"template":{"module":"widgets","url":"templates/FieldObjectButton.html"}},{"type":"button","label":"save","action":function(){tt.save()},"template":{"module":"widgets","url":"templates/FieldObjectButton.html"}}]}';
   </script>
</head>
<body>
	<div> Test Form </div>
	<div dojoType="widgets.FormObject" ></div>
	<div> End test </div>
</body>
</html>