<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
		<title>apstrataDojoSDK core client test suite</title>

	    <style type="text/css">
	    	@import "../../../util/test/resources/test.css";
	    </style>
		
		
		<script type="text/javascript" src="../../../../lib/dojo/1.3.0/dojo/dojo.js" djConfig="parseOnLoad: true, isDesbug: true"></script>
		<script type="text/javascript" src="../../../apstrata.js" apConfig="key:'[my key]', secret:'[my secret]', serviceURL: 'http://apsdb.apstrata.com/sandbox-apsdb/rest', timeout: 10000"></script>
	
	    <script type="text/javascript">
			var client			
			
			function print(msg) {
				dojo.byId("results").innerHTML = dojo.byId("results").innerHTML + "<div class='operation'>" + msg + "</div>" 				
			}
			
	    	function printOperationDecorated(operation, result) {
				var status = result?"success":"fail"
				
				var msg = "<span class='cell label'>" + operation.apsdbOperation + " </span>"
					msg += "<span class='cell " + status + "' id='"+operation.apsdbOperation+"'>" + status + "</span><span>" + operation.responseTime + " ms</span>"
				
				print(msg)
			}
	
			dojo.addOnLoad(function() {
				dojo.require("apstrata.apsdb.client.Client")
				dojo.require("apstrata.util.test.ApstrataUnitTest")
				dojo.require("apstrata.util.logger.Logger")

				test = new apstrata.util.test.ApstrataUnitTest({id:"results"})

				storeName = "testStore" + Math.floor(Math.random()*10000)

				q = new apstrata.apsdb.client.Client()
			
				q.queue("CreateStore", {store: storeName})
				q.queue("SaveDocument", {store: storeName, fields: {type:"q" ,name: "n"+Date(), number: Math.random()}})
//				q.queue("SaveDocument", {store: storeName, fields: {type:"q" ,name: "n"+Date(), number: Math.random()}})
//				q.queue("SaveDocument", {store: storeName, fields: {type:"q" ,name: "n"+Date(), number: Math.random()}})

				q.queue("Query", 
					{
						store: storeName+"x",
						query: "type=\"q\"",
						queryFields: "name, number"
					}
				)
				
				q.queue("DeleteStore", {store: storeName})


				q.execute ({
					continueOnError: true,
					iterationSuccess: function(operation) {
						test.success(operation)
					},
					iterationFailure: function(operation) {
						test.fail(operation)
					},
					success: function() {
						test.print("<h3 class='success' id='all'>Success</h3>")						
					},
					failure: function() {
						test.print("<h3 class='failure' id='all'>Failure</h3>")												
					}
				})

//				conosole.dir(dojo.getObject("apstrata.apsdb.client.Client"))
			})
			
		</script>
	</head>
	<body>
		<h2>Q</h2>
		<div id="results"></div>
	</body>
</html>
